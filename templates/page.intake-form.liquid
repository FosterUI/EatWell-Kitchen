{% comment %}
  ====================================================================
  Meal Prep Intake Form Template
  ====================================================================

  Purpose:
  This template is designed to collect customer information and meal
  preferences for a customized meal prep service. It allows customers
  to submit their personal details, dietary needs, and meal plan
  preferences directly from a Shopify page. The goal is to submit data
  stored as line item properties in Shopify, tying it to the order
  or cart for review by the client.

  Key Features:
  1. **Personal Information Fields**:
     - First Name, Last Name, Email: Prefilled from Shopify's customer data.
     - Phone: Validated for USA format (xxx-xxx-xxxx).
     - Address: Captures customer address for profile updates.

  2. **Dietary Needs**:
     - Food Allergies and Dietary Restrictions fields use multi-line
       text inputs for detailed responses.

  3. **Meal Plan Preferences**:
     - Customers can select meal types using checkboxes.
     - Frequency options are provided as radio buttons.

  4. **Additional Notes**:
     - A freeform multi-line text field allows customers to provide
       any extra information about their preferences.

  5. **Validation**:
     - Required fields ensure critical information is collected.
     - Input formatting (e.g., phone number pattern) ensures clean data.

  6. **Integration with Shopify**:
     - Uses `properties[...]` to attach submitted data as line item
       properties in Shopify orders or cart.
     - Prefilled fields use Liquid variables such as `customer.first_name`.

  Usage Instructions:
  1. Add this file to your theme's `templates` folder as
     `page.intake-form.liquid`.
  2. Create a new page in Shopify Admin and assign this template.
  3. Test the form to ensure all fields work as expected and data is
     stored correctly in Shopify Admin.

  Customization Notes:
  - You can add or modify fields by editing the HTML structure below.
  - Styling can be adjusted in your theme's CSS file or by modifying
    the inline styles in this file.

  ====================================================================
{% endcomment %}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="page-width page-width--narrow">
  <h1 class="main-page-title page-title h0">
    {{ page.title }}
  </h1>
  
  {%- form 'contact', class: 'contact-form' -%}
    {% comment %} Better error handling {% endcomment %}
    {% if form.errors %}
      <div class="form-status-list" role="alert">
        <ul>
          {% for error in form.errors %}
            <li>
              {% if error == 'form' %}
                {{ form.errors.messages[error] }}
              {% else %}
                {{ error }} - {{ form.errors.messages[error] }}
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
    
    <input type="hidden" name="form_type" value="customer_contact" />
    <input type="hidden" name="utf8" value="âœ“" />

    <div class="contact__fields">
      {% comment %} Name field {% endcomment %}
      <div class="field">
        <input
          class="field__input"
          autocomplete="name"
          type="text"
          id="ContactForm-name"
          name="contact[name]"
          value="{% if customer %}{{ customer.name }}{% elsif form.name %}{{ form.name }}{% endif %}"
          placeholder="{{ 'templates.intake_form.form.name' | t }}"
          required
        >
        <label class="field__label" for="ContactForm-name">
          {{- 'templates.intake_form.form.name' | t }}
          <span aria-hidden="true">*</span>
        </label>
      </div>
      {% comment %} Email field {% endcomment %}
      <div class="field field--with-error">
        <input
          autocomplete="email"
          type="email"
          id="ContactForm-email"
          class="field__input"
          name="contact[email]"
          spellcheck="false"
          autocapitalize="off"
          value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
          aria-required="true"
          {% if form.errors contains 'email' %}
            aria-invalid="true"
            aria-describedby="ContactForm-email-error"
          {% endif %}
          placeholder="{{ 'templates.intake_form.form.email' | t }}"
          required
        >
        <label class="field__label" for="ContactForm-email">
          {{- 'templates.intake_form.form.email' | t }}
          <span aria-hidden="true">*</span></label
        >
      </div>
    </div>
    {% comment %} Phone field {% endcomment %}
    <div class="field">
      <input
        type="tel"
        id="ContactForm-phone"
        class="field__input"
        autocomplete="tel"
        name="contact[phone]"
        pattern="[0-9\-]*"
        value="{% if customer %}{{ customer.phone }}{% elsif form.phone %}{{ form.phone }}{% endif %}"
        placeholder="{{ 'templates.intake_form.form.phone' | t }}"
        required
      >
      <label class="field__label" for="ContactForm-phone">
        {{- 'templates.intake_form.form.phone' | t }}
        <span aria-hidden="true">*</span>
      </label>
    </div>
    {% comment %} Address field {% endcomment %}
    <div class="field">
      <textarea
        rows="10"
        id="ContactForm-address"
        class="text-area field__input"
        name="contact[address]"
        placeholder="{{ 'templates.intake_form.form.address' | t }}"
        required
      >{{- form.address -}}</textarea>
      <label class="form__label field__label" for="ContactForm-address">
        {{ 'templates.intake_form.form.address' | t }}
        <span aria-hidden="true"> *</span>
      </label>
    </div>
    {% comment %} Allergies field {% endcomment %}
    <div class="field">
      <textarea
        rows="10"
        id="ContactForm-allergies" 
        class="text-area field__input"
        name="contact[allergies]"
        placeholder="{{ 'templates.intake_form.form.allergies' | escape }}"
        required
      >{{- form.allergies -}}</textarea>
      <label class="form__label field__label" for="ContactForm-allergies">
        {{ 'templates.intake_form.form.allergies' | escape }}
        <span aria-hidden="true"> *</span>
      </label>
    </div>
    {% comment %} Dietary restrictions field {% endcomment %}
    <div class="field">
      <textarea
        rows="10"
        id="ContactForm-dietary-restrictions"
        class="text-area field__input"
        name="contact[dietary_restrictions]"
        placeholder="{{ 'templates.intake_form.form.dietary_restrictions' | t }}"
        required
      >{{- form.body -}}</textarea>
      <label class="form__label field__label" for="ContactForm-dietary-restrictions">
        {{ 'templates.intake_form.form.dietary_restrictions' | t }}
        <span aria-hidden="true"> *</span>
      </label>
    </div>
    {% comment %} Monthly meals? field {% endcomment %}
    <fieldset>
      <legend>{{ 'templates.intake_form.form.monthly_meals' | t }}</legend>
      <div role="radiogroup">
        <div>
          <input
            type="radio"
            name="contact[monthly_meals]"
            value="Yes"
            id="ContactForm-yes"
          >
          <label for="ContactForm-yes">{{ 'templates.intake_form.form.yes' | t }}</label>
        </div>
        <div>
          <input
            type="radio"
            name="contact[monthly_meals]"
            value="No"
            id="ContactForm-no"
          >
          <label for="ContactForm-no">{{ 'templates.intake_form.form.no' | t }}</label>
        </div>
        <div>
          <input
            type="radio"
            name="contact[monthly_meals]"
            value="Maybe"
            id="ContactForm-maybe"
          >
          <label for="ContactForm-maybe">{{ 'templates.intake_form.form.maybe' | t }}</label>
        </div>
      </div>
    </fieldset>
    {% comment %} Meal types field {% endcomment %}
    <div class="field">
      <fieldset>
        <legend>{{ 'templates.intake_form.form.meal_types' | t }}</legend>
        <div>
          <input
            type="checkbox"
            id="ContactForm-meals-breakfast"
            name="contact[breakfast]"
            value="Breakfast"
          >
          <label for="ContactForm-meals-breakfast">{{ 'templates.intake_form.form.breakfast' | t }}</label>
        </div>
        <div>
          <input
            type="checkbox"
            id="ContactForm-meals-lunch"
            name="contact[lunch]"
            value="Lunch"
          >
          <label for="ContactForm-meals-lunch">{{ 'templates.intake_form.form.lunch' | t }}</label>
        </div>
        <div>
          <input
            type="checkbox"
            id="ContactForm-meals-dinner"
            name="contact[dinner]"
            value="Dinner"
            {% if form.meals contains 'Dinner' %}
              checked
            {% endif %}
          >
          <label for="ContactForm-meals-dinner">{{ 'templates.intake_form.form.dinner' | t }}</label>
        </div>
        <div>
          <input
            type="checkbox"
            id="ContactForm-meals-snack"
            name="contact[snack]"
            value="Snack"
            {% if form.meals contains 'Snack' %}
              checked
            {% endif %}
          >
          <label for="ContactForm-meals-snack">{{ 'templates.intake_form.form.snack' | t }}</label>
        </div>
      </fieldset>
    </div>
    {% comment %} Food likes and dislikes field {% endcomment %}
    <div class="field">
      <textarea
        rows="10"
        id="ContactForm-likes-dislikes"
        class="text-area field__input"
        name="contact[dislikes_likes]"
        placeholder="{{ 'templates.intake_form.form.dislikes_likes' | t }}"
      >{{- form.body -}}</textarea>
      <label class="form__label field__label" for="ContactForm-likes-dislikes">
        {{- 'templates.intake_form.form.dislikes_likes' | t -}}
      </label>
    </div>
    {% comment %} Additional information field {% endcomment %}
    <div class="field">
      <textarea
        rows="10"
        id="ContactForm-body"
        class="text-area field__input"
        name="contact[comment]"
        placeholder="{{ 'templates.intake_form.form.comment' | t }}"
      >{{- form.body -}}</textarea>
      <label class="form__label field__label" for="ContactForm-body">
        {{- 'templates.intake_form.form.comment' | t -}}
      </label>
    </div>
    {% if form.posted_successfully? %}
      <div class="form-status-list form__message" role="status">
        <h3 class="form-status-list__title">
          {{ 'templates.intake_form.form.post_success' | t }}
        </h3>
      </div>
    {% endif %}
    {% comment %} Send button {% endcomment %}
    <div class="contact__button">
      <button type="submit" class="button">
        {{ 'templates.intake_form.form.send' | escape }}
      </button>
    </div>
  {%- endform -%}
</div>

{% schema %}
{
  "name": "Intake Form",
  "settings": [
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding", 
      "default": 36
    }
  ]
}
{% endschema %}
